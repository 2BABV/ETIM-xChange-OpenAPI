type: object
description: |
  Allowance or surcharge linked to a pricing entry via `pricingRef`.
  Use `pricingRef` to correlate with the corresponding pricing record
  from the `/pricings` endpoint.
  
  **ETIM xChange**: `AllowanceSurcharge`
  **Path**: `Supplier[].Product[].TradeItem[].Pricing[].AllowanceSurcharge[]`
additionalProperties: false
required:
  - pricingRef
  - allowanceSurchargeIndicator
  - allowanceSurchargeType
properties:
  # --- Pricing Reference Key ---
  pricingRef:
    description: |
      Server-generated opaque reference key that identifies the parent pricing entry.
      Use this to correlate with the corresponding pricing record from the `/pricings` endpoint.
      
      This is a technical identifier not present in the ETIM xChange domain model.
    $ref: ../../../../shared/schemas/identifiers/TechnicalId.yaml
    examples:
      - "price-c62-1-20250101"
      - "f47ac10b-58cc-4372-a567-0e02b2c3d479"

  # --- Allowance/Surcharge Fields ---
  allowanceSurchargeIndicator:
    type: string
    description: |
      Indicates whether this price adjustment is an allowance (discount) or a surcharge (additional charge).
      **ETIM xChange**: `AllowanceSurchargeIndicator`
    enum:
      - ALLOWANCE
      - SURCHARGE
    examples:
      - ALLOWANCE
      - SURCHARGE
  allowanceSurchargeValidityDate:
    type: ["string", "null"]
    format: date
    description: |
      Date from which the allowance or surcharge becomes valid.
      **ETIM xChange**: `AllowanceSurchargeValidityDate`
    examples:
      - "2025-01-01"
      - null
  allowanceSurchargeType:
    description: |
      Code describing the reason for the allowance or surcharge.
      **ETIM xChange**: `AllowanceSurchargeType`
    $ref: ../../../../shared/schemas/common/AllowanceSurchargeTypes.yaml
  allowanceSurchargeAmount:
    type: ["number", "null"]
    description: |
      Fixed monetary amount of the allowance or surcharge.
      **ETIM xChange**: `AllowanceSurchargeAmount`
    minimum: 0
    multipleOf: 0.0001
    maximum: 99999999999.9999
    examples:
      - 15.5
      - null
  allowanceSurchargeSequenceNumber:
    type: ["integer", "null"]
    description: |
      Sequence number used to order multiple allowances or surcharges applied to the same price.
      **ETIM xChange**: `AllowanceSurchargeSequenceNumber`
    minimum: 1
    examples:
      - 1
      - null
  allowanceSurchargePercentage:
    type: ["number", "null"]
    description: |
      Percentage rate of the allowance or surcharge.
      **ETIM xChange**: `AllowanceSurchargePercentage`
    minimum: 0
    multipleOf: 0.001
    maximum: 999.999
    examples:
      - 5.5
      - null
  allowanceSurchargeDescription:
    description: |
      Multilingual description of the allowance or surcharge.
      **ETIM xChange**: `AllowanceSurchargeDescription[]`
    anyOf:
      - type: array
        items:
          type: object
          additionalProperties: false
          required:
            - allowanceSurchargeDescription
          properties:
            language:
              $ref: ../../../../shared/schemas/common/LanguageCode.yaml
            allowanceSurchargeDescription:
              type: string
              minLength: 1
              maxLength: 35
      - type: "null"
    examples:
      - null
      - - language: en
          allowanceSurchargeDescription: Early payment discount
  allowanceSurchargeMinimumQuantity:
    type: ["number", "null"]
    description: |
      Minimum ordered quantity required for the allowance or surcharge to apply.
      **ETIM xChange**: `AllowanceSurchargeMinimumQuantity`
    minimum: 0
    multipleOf: 0.0001
    maximum: 999999999999.9999
    examples:
      - 10
      - null

examples:
  - pricingRef: "price-c62-1-20250101"
    allowanceSurchargeIndicator: ALLOWANCE
    allowanceSurchargeValidityDate: "2025-01-01"
    allowanceSurchargeType: AEQ
    allowanceSurchargeAmount: null
    allowanceSurchargeSequenceNumber: 1
    allowanceSurchargePercentage: 5.5
    allowanceSurchargeDescription:
      - language: en
        allowanceSurchargeDescription: Bulk quantity discount
    allowanceSurchargeMinimumQuantity: 50
